"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[341],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var u=r.createContext({}),s=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=s(e.components);return r.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,u=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=s(n),h=o,m=d["".concat(u,".").concat(h)]||d[h]||p[h]||i;return n?r.createElement(m,a(a({ref:t},c),{},{components:n})):r.createElement(m,a({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=d;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var s=2;s<i;s++)a[s]=n[s];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6679:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return u},metadata:function(){return s},toc:function(){return c},default:function(){return d}});var r=n(7462),o=n(3366),i=(n(7294),n(3905)),a=["components"],l={sidebar_position:2},u="Spinning Up a Router",s={unversionedId:"Routers/Guides/spinning-up",id:"Routers/Guides/spinning-up",isDocsHomePage:!1,title:"Spinning Up a Router",description:"Minimum Hardware Requirements",source:"@site/docs/Routers/Guides/spinning-up.md",sourceDirName:"Routers/Guides",slug:"/Routers/Guides/spinning-up",permalink:"/documentation/Routers/Guides/spinning-up",editUrl:"https://github.com/integer-underflow/documentation/docs/Routers/Guides/spinning-up.md",version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"routers",previous:{title:"Checklist for Running a Router",permalink:"/documentation/Routers/Guides/checklist"},next:{title:"Providing Liquidity Using Router Contract",permalink:"/documentation/Routers/Guides/providing-liquidity"}},c=[{value:"Minimum Hardware Requirements",id:"minimum-hardware-requirements",children:[]},{value:"Required Software",id:"required-software",children:[]},{value:"Network Configuration",id:"network-configuration",children:[]},{value:"Cloning the Repository",id:"cloning-the-repository",children:[]},{value:"Basic Configuration",id:"basic-configuration",children:[{value:"Environment Config",id:"environment-config",children:[]},{value:"Web3Signer Config",id:"web3signer-config",children:[]},{value:"Router Config",id:"router-config",children:[]}]},{value:"Deploying a Router Contract",id:"deploying-a-router-contract",children:[]},{value:"Running the Router",id:"running-the-router",children:[]},{value:"View Logs",id:"view-logs",children:[]},{value:"Grafana Dashboard",id:"grafana-dashboard",children:[]}],p={toc:c};function d(e){var t=e.components,n=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"spinning-up-a-router"},"Spinning Up a Router"),(0,i.kt)("h2",{id:"minimum-hardware-requirements"},"Minimum Hardware Requirements"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"4GB RAM"),(0,i.kt)("li",{parentName:"ul"},"30GB Storage")),(0,i.kt)("h2",{id:"required-software"},"Required Software"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.docker.com/install/"}," Docker CE (Community Edition) ")," version 20.10.5 or higher"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.docker.com/compose/install/"}," Docker Compose ")," version 1.27.4 or higher")),(0,i.kt)("h2",{id:"network-configuration"},"Network Configuration"),(0,i.kt)("p",null,"The router requires the following ports to be open to the public:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"4222"))),(0,i.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Do NOT expose the ",(0,i.kt)("inlineCode",{parentName:"p"},"ROUTER_EXTERNAL_PORT")," to anyone untrusted! It should only be accessible by the operator in a trusted environment."))),(0,i.kt)("h2",{id:"cloning-the-repository"},"Cloning the Repository"),(0,i.kt)("p",null,"To spin up a router, first clone the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/connext/nxtp-router-docker-compose"},(0,i.kt)("inlineCode",{parentName:"a"},"nxtp-router-docker-compose"))," repository."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ git clone https://github.com/connext/nxtp-router-docker-compose.git\n")),(0,i.kt)("h2",{id:"basic-configuration"},"Basic Configuration"),(0,i.kt)("h3",{id:"environment-config"},"Environment Config"),(0,i.kt)("p",null,"Create a ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," file in the root directory of the repository based on the ",(0,i.kt)("inlineCode",{parentName:"p"},"env.example")," file."),(0,i.kt)("p",null,"Modify the following environment variables:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ROUTER_VERSION")," - The version of the router to use (e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"v0.1.0"),"). See the ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/connext/nxtp/releases"},"releases page")," for the latest released version."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ROUTER_EXTERNAL_PORT")," - Exposed port of the router. Remember to not expose this port to the public."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"GRAFANA_EXTERNAL_PORT")," - Exposed port of the Grafana dashboard.")),(0,i.kt)("h3",{id:"web3signer-config"},"Web3Signer Config"),(0,i.kt)("p",null,"Set up ",(0,i.kt)("a",{parentName:"p",href:"https://docs.web3signer.consensys.net/en/latest/"},"Web3Signer")," config files to set the private key securely."),(0,i.kt)("h3",{id:"router-config"},"Router Config"),(0,i.kt)("p",null,"Create a ",(0,i.kt)("inlineCode",{parentName:"p"},"config.json")," file based on the ",(0,i.kt)("inlineCode",{parentName:"p"},"config.example.json")," file. At minumum, change the following values:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"adminToken")," - A secret string for performing sensitive operations."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"chainConfig")," - Add your desired chains and provider URLs. NOTE: Make sure to add chain 1 (Ethereum mainnet) providers."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"web3SignerUrl")," - Set to ",(0,i.kt)("inlineCode",{parentName:"li"},'"http://signer:9000"'),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"routerContractAddress")," - Set to the address of the router contract, see the section below."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"swapPools")," - Change to desired assets.")),(0,i.kt)("p",null,"See the ",(0,i.kt)("a",{parentName:"p",href:"../Reference/configuration"},"Configuration")," section for more details."),(0,i.kt)("h2",{id:"deploying-a-router-contract"},"Deploying a Router Contract"),(0,i.kt)("p",null,'On each chain you want to operate on you must deploy a router contract. This contract will control act as the router\'s "wallet" and allow relayers to send transactions on behalf of the router, for a fee.'),(0,i.kt)("p",null,"You can deploy the router contract by going to the block explorer on the chain you want to deploy the router on, then using the Write Contract functionality of the explorer on the ",(0,i.kt)("inlineCode",{parentName:"p"},"RouterFactory")," contract. Call the ",(0,i.kt)("inlineCode",{parentName:"p"},"createRouter")," method on the ",(0,i.kt)("inlineCode",{parentName:"p"},"RouterFactory")," contract with the following parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"routerSigner"),": EOA address which corresponds to the router's configured signer. Will be the same on all chains."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"recipient"),": Address at which router will get funds back when it calls ",(0,i.kt)("inlineCode",{parentName:"li"},"removeLiquidity()"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"msg.sender"),": Will be the owner of the Router Contract. This can be any EOA that you can keep secret, you will need to use it in case you want to change recipient or ",(0,i.kt)("inlineCode",{parentName:"li"},"removeRelayerFee")," on Router.sol contract. For extra security, you can use the ",(0,i.kt)("inlineCode",{parentName:"li"},"setOwner()")," function on the contract and set this address to the burn address to prevent anyone from changing the recipient.")),(0,i.kt)("p",null,"The current router factory address on every chain is ",(0,i.kt)("inlineCode",{parentName:"p"},"0x73a37b3EB030cC3f9739CA5C16b7E6802F294122")," and the contract is verified on every chain. If you have any issues/questions about this, please contact the Connext team! This process needs to be completed on all chains!"),(0,i.kt)("p",null,"Make sure the Connext team is aware of your router contract address and EOA signer address in case anything needs whitelisting!"),(0,i.kt)("h2",{id:"running-the-router"},"Running the Router"),(0,i.kt)("p",null,"Run the router with ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ docker-compose up -d\n")),(0,i.kt)("p",null,"Test if it's working by querying the ",(0,i.kt)("inlineCode",{parentName:"p"},"/config")," endpoint. Log into the host or the router container and run the following curl command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'# assumes ROUTER_EXTERNAL_PORT is 8000, on the container itself it will be 8000\n$ curl localhost:8000/config\n{"signerAddress":"0x9ADA6aa06eF36977569Dc5b38237809c7DF5082a"}\n')),(0,i.kt)("h2",{id:"view-logs"},"View Logs"),(0,i.kt)("p",null,"Use docker commands to check logs of any of the running containers."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ docker logs router\n# or\n$ docker logs --follow --tail 100 router\n")),(0,i.kt)("h2",{id:"grafana-dashboard"},"Grafana Dashboard"),(0,i.kt)("p",null,"The router runs a Grafana dashboard which is available at the on the configured ",(0,i.kt)("inlineCode",{parentName:"p"},"GRAFANA_EXTERNAL_PORT"),"."))}d.isMDXComponent=!0}}]);